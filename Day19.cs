namespace advent_of_code_2017
{
    using System;
    using System.Linq;
    using System.Collections.Generic;

    public class Day19
    {
        private const string Problem1Input =
"                                                                                                                                                         |                                               " + "\n" +
"                                                 +-------------------------------------------------------------------------------------------------------------------------------------------+           " + "\n" +
"                                                 |                                                                                                       |                                   |           " + "\n" +
" +---------+                                     |         +---------------+         +-------------+           +---+   +-----------------------------------------------------------------+   |           " + "\n" +
" |         |                                     |         |               |         |             |           |   |   |                                 |                               |   |           " + "\n" +
" |         |         +---------------+       +---|-------------------------|---------|---+         |           +-----------------------------------------|-------------------------------|-------------+ " + "\n" +
" |         |         |               |       |   |         |               |         |   |         |               |   |                                 |                               |   |         | " + "\n" +
" +-------------------------------------------|---|-------------------------|-------------|-------------------------|---|---------------------------+     |             +---+ +-------------------+ +-+ | " + "\n" +
"           |         |               |       |   |         |               |         |   |         |               |   |                           |     |             |   | |           |   |   | | | | " + "\n" +
" +---------|---------+               |       +-----------------------------|---------|---|---------|---------------|------D--------------------------------------------------|-------------------+ | | | " + "\n" +
" |         |                         |           |         |               |         |   |         |               |   |                           |     |             |   | |           |   |     | | | " + "\n" +
" |   +-------------------------------------------|-------+ |               |         |   |       +-|-----+     +---------------------------------+ | +---|-------------|-------------------+ |     | | | " + "\n" +
" |   |     |                         |           |       | |               |         |   |       | |     |     |   |   |                         | | |   |             |   | |           | | |     | | | " + "\n" +
" |   |     |                       +---------+   |       | |               |         |   |       | |     |     |   |   |           +-------------|---|---|-------------+   | |           | | |     | | | " + "\n" +
" |   |     |                       | |       |   |       | |               |         |   |       | |     |     |   |   |           |             | | |   |                 | |           | | |     | | | " + "\n" +
" | +-------------------+           | | +-----------------|-|-------------------------|---|-------------+ | +-+ +---|-----------------+   +-------|----R--|-----------------------+ +-+   | | +-+   | | | " + "\n" +
" | | |     |           |           | | |     |   |       | |               |         |   |       | |   | | | |     |   |           | |   |       | | |   |                 | |   | | |   | |   |   | | | " + "\n" +
" | | |     |           |           | | |     |   |       | |     +-+ +-------------------|---------|---|-----------|---------------|-|---|---------|-|---|-------------+   | |   | | |   | |   |   | | | " + "\n" +
" | | |     |           |           | | |     |   |       | |     | | |     |         |   |       | |   | | | |     |   |           | |   |       | | |   |             |   | |   | | |   | |   |   | | | " + "\n" +
" | | |     |         +-|-------------------------|---------|---------|---------+     |   |       | |   | | | |     |   |           +-----|-------+ | |   |             |   | |   | +-|---|-+   |   | | | " + "\n" +
" | | |     |         | |           | | |     |   |       | |     | | |     |   |     |   |       | |   | | | |     |   |             |   |         | |   |             |   | |   |   |   |     |   | | | " + "\n" +
" | | |     |         | |           | +-----------|---------+     | | |     | +-|-----|---|-------|-----|-----|-----------------------|---+     +---------|-------------|-------------|---|-------------+ " + "\n" +
" | | |     |         | |           |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |         |   | |   |             |   | |   |   |   |     |   | |   " + "\n" +
" | +-|-----------------------------|---------|---|-------|-----------------|-|-|-----|-----------|---------------------------------------------+   | |   |             |   | |   |   |   |     |   | |   " + "\n" +
" |   |     |         | |           |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |             | |   |             |   | |   |   |   |     |   | |   " + "\n" +
" |   |     |         | |     +-+   |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |       +-----|-|---|-------+     |   | |   +-------|-------+ | |   " + "\n" +
" |   |     |         | |     | |   |   |     |   |       |       | | |     | | |     |   |       | |   | | | |     |   |             |       |     | |   |       |     |   | |       |   |     | | | |   " + "\n" +
" |   |     |         | |     | +-------|-----|-----------|-----------|---+ | | |     |   |       | |   | | | +-----|---|-+ +---------|-------|-------|---|-------|-----|---+ |       |   |     | | | |   " + "\n" +
" |   |     |         | |     |     |   |     |   |       |       | | |   | | | |     |   |       | |   | | |       |   | | |         |       |     | |   |       |     |     |       |   |     | | | |   " + "\n" +
" | +-------------------|-----|---------|-----|---|---------------|-|-------|-|-------|-----------+ | +---|-|---+   |   | +---+       |       +-----------|-------|-----------|-------|---------|-+ | |   " + "\n" +
" | | |     |         | |     |     |   |     |   |       |       | | |   | | | |     |   |         | | | | |   |   |   |   | |       |             | |   |       |     |     |       |   |     |   | |   " + "\n" +
" | | |     |         | |     |     |   | +-------|-------------------------|---|---------+         | | | | |   |   |   |   | |       |       +-----|-|-----------+   +---------------+   |     |   | |   " + "\n" +
" | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |   |   | |       |       |     | |   |           | |     |           |     |   | |   " + "\n" +
" | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |   +---|-|-------|-------|-----|-----|-------+   | |     |           | +---|---|-|-+ " + "\n" +
" | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   |   |       | |       |       |     | |   |       |   | |     |           | |   |   | | | " + "\n" +
" | | |     |         | |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   | +---------|-|---------------|-----|-----|---+   |   | |     |           | |   |   | | | " + "\n" +
" | | |     |         S |     |     |   | |   |   |       |       | | |   | | | |     |             | | | | |   | | |       | |       |       |     | |   |   |   |   | |     |           | |   |   | | | " + "\n" +
" | | |     |   +-------|-----|--------F|-|---|---|---------------------+ | | | |     |             | | | | |   | | |       | +-----------+   +-+ +-|-|---|---|-------|-----------------+ | |   |   | | | " + "\n" +
" | | |     |   |     | |     |     |   | |   |   |       |       | | | | | | | |     |             | | | | |   | | |       |         |   |     | | | |   |   |   |   | |     |         | | |   |   | | | " + "\n" +
" | | |     |   |     | |     |     |   | |   |   |       |       | | | | | | +-|-----+         +---|-----------+ | |     +---------------|---------------|---|-----+ +-|---------+     | | |   |   | | | " + "\n" +
" | | |     |   |     | |     |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |     | | | |   |   |   | |   |     |   |     | | |   |   | | | " + "\n" +
" | | |     | +---+   | +-----|-----|---------------------|-------|-|---|-----------------------|-------|-|-------|-------|-----------|---|---------|-----|-------|-|-+ |     |   |     | | |   |   | | | " + "\n" +
" | | |     | | | |   |       |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |     | | | |   |   |   | | | |     |   |     | | |   |   | | | " + "\n" +
" +-|---+   | | | +---------------------------|-------------------------|-|---------------------|---------|---------------|-----------|-------+ | | | |   |   |   | | | |     |   |     | | |   |   | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |       |       | | | | | |   |               |   | | | | |     | |     | |         |   |   | | | | |   |   |   | | | |     |   |     | | |   |   | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |       |   +---|---|-|-|-----|-------------------|---|---|-------------|-----------------------|-|-|-+ |   |   | | | |     |   |     | | |   |   | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |       |   |   | | | | | |   |               |   | | | | |     | |     | |         |   |   | | | | | | |   |   | | | |     |   |     | | |   |   | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |       +---|---|-|---|-|---+ |               |   | | | | +-----|-|-----|---+ +-----|---+   | | | | | | |   |   | | | |     |   |   +-|-|-+   |   | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |           |   | | | | | | | |               |   | | | |       | |     | | | |     |       | | | | | | |   |   | | | |     |   |   | | |     |   | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |           |   | | | +-|-|-|-|-------------------|-|-------------|---+ | | | |     |       | | | | | | |   |   | | | |     |   |   | | | +---|-+ | | | " + "\n" +
"   | | |   | | |     |       |     |   | |   |   |           |   | | |   | | | |               |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   | | | |   | | | | | " + "\n" +
"   | | +-----|-+     |   +---------|-----|---|---------------|-----|---------|-----------------|---|-|-|-----------|-------|---|-----|-------|-|-|---|-|---------|-|---|---------|---|-----+   | | | | | " + "\n" +
"   | |     | |       |   |   |     |   | |   |   |           |   | | |   | | | |               |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   | | |     | | | | | " + "\n" +
" +---|---+ | |       |   |   |     |   | |   +---------+     |   | | |   | | | |             +-|---|---|---------|-------|-|-|-|-----|-------------|---|-----|-----|---|-------------|-+ |     | | | | | " + "\n" +
" | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | |   | | | | |     |       | | | | | | |   |   | | | |     |   |   |   |     | | | | | " + "\n" +
" | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | | +-----|---+     |       | | +-|-|---|---|---|-----|-----|---|-------|---+ | | | | | " + "\n" +
" | | |   | | |       |   |   |     |   | |       |     |     |   | | |   | | | |             | |   | | | |       | | | | | | |       |       | |   | | | |   |   | | | |     |   |   |   |   | | | | | | " + "\n" +
" | | |   | +-|-------|---|-+ |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   +-----|-|-|---|-|-------|-------|-----|-|-+ |   |   | | | |     |   |   |   |   | | | | | | " + "\n" +
" | | |   |   |       |   | | |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   |   | | | | | | |       |       | |   | |   |   |   | | | |     |   |   |   |   | | | | | | " + "\n" +
" | | | +-------+ +---|---|-|-----------|-|-------|-----|-----|---|-|-----|-----|-------------|-----|-----------------|---+ | |       |       | +---|-+ +-----|-------|-----------|---+   |   | | | | | | " + "\n" +
" | | | | |   | | |   |   | | |     |   | |       |     |     |   | | |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | | | |     |   |       |   | | | | | | " + "\n" +
" | | | | |   | | |   |   | | |     |   | |       |     |     | +-|-+ |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | | +-------|-+ |       |   | | | | | | " + "\n" +
" | | | | |   | | |   |   | | |     |   | |       |     |     | | |   |   | | | |             | |   | | | |   |   | | | |   | |       |       |     |   | |   |   | |   |     | | |       |   | | | | | | " + "\n" +
" | | | +-|-----|-------------|---------|---------|-----------|-----------------|-------------|-|---|-------+ |   | | | |   | |       |   +-------+ |   | |   |   | |   +-----|-|-|-----------|---|-|---+ " + "\n" +
" | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |   | | | |             | |   | | | | | |   | | | |   | |       |   |   |   | |   | |   |   | |         | | |       |   | | | | |   " + "\n" +
" | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |   +-|-|-|---------------------|-----|-|-----|-|-------------------|---|-+ | |   | |   |   | |         | | |       |   | | | | |   " + "\n" +
" | | |   |   | | |   |   | | |     |   | |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   |   | | | |   | |   |   | |         | | |       |   | | | | |   " + "\n" +
" | | |   +---|-|-|---------------+ | +-+ |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | +-+ | +-------|-------------------|---|-------|---------+ |   " + "\n" +
" | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |   " + "\n" +
" | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |   " + "\n" +
" | | |       | | |   |   | | |   | | |   |       |     |     | | |   |     | | |             | |   | | | | | |   | | | |   | |       |   | |   |   |   | |   |   | |         | | |       |   | | |   |   " + "\n" +
" | | |     +-----|---|-----|-|---|-|-----|---------+   |     | | |   |     | | |         +-----|-------+ | +-----|---|-------|-------|-----|-----------------|---|-|---------|-|-|-+     |   | | |   |   " + "\n" +
" | | |     | | | |   |   | | |   | | |   |       | |   |     | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   | |         | | | |     |   | | |   |   " + "\n" +
" | | |     | | | |   |   | | |   | | |   |       | |   +---------------------|-----------------|-----------------|-|-|-|---|-|-------------|-----------------|-----+         | | | |     |   | | |   |   " + "\n" +
" | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |   | | |   |   " + "\n" +
" | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |   +-------|-+ " + "\n" +
" | | |     | | | |   |   | | |   | | |   |       | |         | | |   |     | | |         |   | |   | |   |   |   | | | |   | |       |   | |   |   |   | |   |   |           | | | |     |     | |   | | " + "\n" +
" | | | +---|-----|---|-----------|-|-|-------------|-----+   +---|-+ |     | | |         |   | |   | |   |   |   | +---------|-----+ |   | |   |   |   | |   |   |           | | | |     |     | |   | | " + "\n" +
" | | | |   | | | |   |   | | |   | | |   |       | |     |     | | | |     | | |         |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |           | | | |     |     | |   | | " + "\n" +
" | | | | +-+ +---|---------+ |   | | +---|-------|-|-----|---------|-|-----|-------------------|---|-|---|---------------------------|---|-|-------------|-------|-----------+ | | |   +---------+ +---+ " + "\n" +
" | | | | |     | |   |   |   |   | |     |       | |     |     | | | |     | | |         |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |             | | |   | |     |   | |   " + "\n" +
" | | | | +-+   | |   |   +---|-----|-----+       | |     +-------|-|-|-----|-|-|-------+ |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |             +-|-|---|-------------|-+ " + "\n" +
" | | | |   |   | |   |       |   X |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   |   |               | |   | |     |   | | | " + "\n" +
" | | | +---|-+ | |   |       |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |   +---|-----------------+   | |     |   | | | " + "\n" +
" | | |     | | | |   |       |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |   | |   | |     | |   | |   |   |   | |       |               |     | |     |   | | | " + "\n" +
" | | |     | | | |   |   +-------|---------------|-|-------------|-|---------|-----------|---|-----|-----|-----------+ |   | |     +-|-----|---+   |   | +-------|-------+ +-----|-----+ |     |   | | | " + "\n" +
" | | |     | | | |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |       |   | |       |   |         |       | |     |       |     |   | | | " + "\n" +
" | | |   +---|---|-----------|---|-|-------------|---------------|-|---------------------|-----|---|-----|---|---|-----|-----------+ |   | |       |   |         |     +-|---------------------|-+ | | | " + "\n" +
" | | |   | | | | |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | | " + "\n" +
" +-|-|-----|---+ |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | | " + "\n" +
"   | |   | | |   |   |   |   |   | |             | |           | | | |     | | |       | |   | |   | |   |   |   |     |   | |     | |   | |       |   |         |     | | |     |       |     | | | | | " + "\n" +
"   | |   | | |   |   |   |   |   | | +-------------|-----------------|---------|-------|-----|-----|-|---|---|---+     |   | |     +-----|---------|-------------|-----|---|-----|-------|-----|-+ | | | " + "\n" +
"   | |   | | |   |   |   |   |   | | |           | |           | | | |     | | |       | |   | |   | |   |   |         |   | |       |   | |       |   |         |     | | |     |       |     |   | | | " + "\n" +
" +-|-|---|-|-|-------|-----------|---|---+       | |           | | +---------|---------|-|---------------|-------------|---|-+       |   | |       | +-|---------|-------|-------------+ |     |   | | | " + "\n" +
" | | |   | | |   |   |   |   |   | | |   |       | |           | |   |     | | |       | |   N |   | |   |   |         |   |         |   | |       | | |         |     | | |     |     | |     |   | | | " + "\n" +
" | | |   +-|-|-----------|---|---|-|---------------|-------------|-----+   | | |       | |   | |   | |   |   |         |   |       +-------------+ | | |         |     | | |     | +---|-|-----+   | | | " + "\n" +
" | | |     | |   |   |   |   |   | | |   |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       | |   | |     | | | |         |     | | |     | |   | |         | | | " + "\n" +
" | | +-+   | |   +---|-------|-----|-+   |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       | +-------------|---|---------|-----|---------|-----|-----------+ | | " + "\n" +
" | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | | " + "\n" +
" | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | | " + "\n" +
" | |   |   | |       |   |   |   | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | | |         |     | | |     | |   | |           | | " + "\n" +
" | |   |   | |       |   |   | +---|---------------|-----------------|-|-------|-------|-----------|-|---|---|---------------------------|-------|-----+         |     | | |     | |   | |   +-----+ | | " + "\n" +
" | |   |   | |       |   |   | | | |     |       | |           | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | | " + "\n" +
" | |   |   | | +-------------|-------------------|-|---+       | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | |     |       | |   |       | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | |     | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | | +-+ |       | |   | +-------|-----|---|-|----------------P----|-----|---|---------|---|-------------|-|---------|-----------|-----|-|-|-+   | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |           |     | | | |   | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | | | +---------|-------|-----|-----|---------|---------------|---------|-------------|-----------|-----|-|-------|---------+   |     | | | |   | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | | |   |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |         |   |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | | | +-|---------------|-----|-------|---|-----------|-------|-----|-------|---------+   |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | | " + "\n" +
" | |   |   | | |     |   |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       |     | |     | | |       |   |     | | | |   | |   | |   |     | | | " + "\n" +
" | |   |   | | |     +-------------|-------------|-------|-----|-----------|-|-|-------|---------------------|-------------|-----------------------|---------|---+     | | +-------|---|-----+   +-+ | | " + "\n" +
" | |   |   | | |         |   | | | | | | |       | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       |     | |     | | |       |         | |   |   | |   | |       |   | | " + "\n" +
" | |   |   | | |       +-------|-|-|-|-|-------+ | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       | +-----|-----|-----------------+   | |   |   +-|-+ | |       | +---+ " + "\n" +
" | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |   | | |       | |   | |   | |   |   |             |       | |   | |     | | |       |     |   | |   |     | | | |       | | |   " + "\n" +
" | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |   +---|-----+ | |   | |   | |   |   |             |       | |   | |     | | |   +---|---------|-|---+     | | | |       | | +-+ " + "\n" +
" | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |   | |   | |   |   |             |       | |   | |     | | |   |   |     |   | |         | | | |       | |   | " + "\n" +
" | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |   +-|-+ +---------|---------+   |       | |   | | +-------|-------------|---|-|---------|-------------+ |   | " + "\n" +
" | |   |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |     | |   |   |   |         |   |       | |   | | |   | | |   |   |     |   | |         | | | |         |   | " + "\n" +
" | | +-------|-|---------|---|-----|---|-|-----|-|-------|-----|-------|-------|-------|-|-------|---------------------|---|---------|---|-|-----|-|-|---|---|-------+ | |         | | | |     +---+   | " + "\n" +
" | | | |   | | |       | |   | | | | | | |     | | |   | |     | |   | |     | |     | | |     | |   |   |   |         |   |       | |   | | |   | | |   |   |     | | | |         | | | |     |       | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   +-+ | |   | |   +---------|-------------|---------|-----|---|-----------------+       | |   | | |   | | |   |   |     | +-|---+       | | | |     |       | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   |   |         |           | |   | | |   | | |   |   |     |   | | |       | | | |     |       | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   | +-|---------------------|---------|---|---|---|-------------|-----------|---|-|-----|---+   | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   |   | | |         |           | |   | | |   | | |   |   |     |   | | |       | | | |     |   |   | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |   +-----|-|---------------------|-|---|-|-|-----|-----|---+     |   | | |       | | | |     |   |   | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   | |   | |   | | |   | |     | |     | | |     | |       | | |         |           | |   | | |   | | |   |         |   | | |       | | | |     |   |   | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   | +---------|-------|-------|-|---------------|-|---------|-|---------|-----------|-|-----------|---|-----+       |   | | |       | | | |     |   |   | " + "\n" +
" | | | |   | | |       | |   | | | | | | |   |   |     | |   | | |   | |     | |     | | |     | |       | | |         |           | |   | | |   | | |   | |       |   | | |       | | | |     |   |   | " + "\n" +
" | | | |   | | |       | +---|-|---|-----|---|-----------|---+ | |   | |     | |     | | |     | |       | | |         +-----------|-------|-----|-|-----------------------------------|-|-----|---|-+ | " + "\n" +
" | | | |   | | |       |     | | | | | | |   |   |     | |     | |   | |     | |     | | |     | |       | | |                     | |   | | |   | | |   | |       |   | | |       | | | |     |   | | | " + "\n" +
" | | | | +-----------------------|-----|-|---+   |     | |     | |   | |     | |     | | |     | |       | | +---------------------|-------|-|-----|-|---|---------|---|-----------|-|-|-----------|-+ | " + "\n" +
" | | | | | | | |       |     | | | | | | |       |     | |     | |   | |     | |     | | |     | |       | |                       | |   | | |   | | |   | |       |   | | |       | | | |     |   |   | " + "\n" +
" | | +---+ | | |       |     | | | | | +-----------------|-----|-----|---------------|---------------------------------------------|-----|---------|-|-------------------|---------|-----|-----|-----+ | " + "\n" +
" | |   |   | | |       |     | | | | |   |       |     | |     | |   | |     | |     | | |     | |       | |                       | |   | | |   | | |   | |       |   | | |       | | | |     |   | | | " + "\n" +
" | |   |   | | |       |     | | | | |   |       |     | | +-+ +-----|-------|---------|-----+ | |       | |                       | |   | | |   | | |   | |       | +-|-|-------+ | | | |     |   | | | " + "\n" +
" | |   |   | | |       |     | | | | |   |       |     | | | |   |   | |     | |     | | |   | | |       | |                       | |   | | |   | | |   | |       | | | | |     | | | | |     |   | | | " + "\n" +
" +-|-----------|-------|-----+ +---+ |   |   +-------------|---------|-------|-------|-|--------------J--|-+                       +-+   | | |   | | |   | |       | | | | |     | | | | |     |   | | | " + "\n" +
"   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |   | | |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | | " + "\n" +
"   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |   +-+ |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | | " + "\n" +
"   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     | | |       |       |                               | | |   | | |   | |       | | | | |     | | | | |     |   | | | " + "\n" +
"   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |     +-|---------|---------------------------------------|-|---------|---|-|-------|-+ | | |     | | | | |     |   | | | " + "\n" +
"   |   |   | | |       |         |   |   |   |   |     | | | |   |   | |     | |       | |       |       |                               | | |   | | |   | |       |   | | |     | | | | |     |   | | | " + "\n" +
" +-|-+ |   | | |     +-|---------|-+ |   +-----------------|-|---|---|-|-----|-|-------|-|---------------|---+                           | +-+   | | |   | |       |   | | |   +-|-------|-----|---+ | | " + "\n" +
" | | | |   | | |     | |         | | |       |   |     | | | |   |   | |     | |       | |       |       |   |                           |       | | |   | |       |   | | |   | | | | | |     |     | | " + "\n" +
" | | | | +-|-|-------------------|-|---------------------+ | |   |   +---------|-----------------------------|---------------------------|---------|-|---+ |       |   | | |   | | | +-|-------|-+   | | " + "\n" +
" | | | | | | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       |   |                           |       | | |     |       |   | | |   | | |   | |     | |   | | " + "\n" +
" | +-|---+ | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       | +-|---------------------------|---------|-|-------------|-----|-------|-|---|---------|-+ | | " + "\n" +
" |   | |   | | |     | |         | | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |       |   | | |   | | |   | |     | | | | | " + "\n" +
" |   | |   | | |     | +---------|-|-|---------------------------------|-----|-|-------|---------|---------|-|---------------------------|---------|-------------+ |   | | +-------|---|-------|-|-+ | | " + "\n" +
" |   | |   | | |     |           | | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     | |   | | " + "\n" +
" +-+ | |   | | |     |   +-------+ | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     | +-+ | | " + "\n" +
"   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | | " + "\n" +
"   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | | " + "\n" +
"   | | |   | | |     |   |         | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | | |     |     | |   | |     | | |   | |     |   | | | " + "\n" +
"   | | |   | | |     |   |   +-------|-------|---|---------------|-----------------------|---------------|-----------------------------------------|-+     |     +-|---+ |     | | |   | +-------+ | | | " + "\n" +
"   | | |   | | |     |   |   |     | |       |   |     |   | |   |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | | " + "\n" +
"   | | |   | | |     |   |   | +---|-|-----------|-----|-------+ |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | | " + "\n" +
"   | | |   | | |     |   |   | |   | |       |   |     |   | | | |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | |   |       | | | | | " + "\n" +
"   | | |   | | |     |   |   +-|-------------|---------------|---------|---------------------------------|-|-------------------------------------|-|---------------------------|-|---+ |       | | | | | " + "\n" +
"   | | |   | | |     |   |     |   | |       |   |     |   | | | |     |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | |       | | | | | " + "\n" +
" +-----------|-|-----------------------------|---|---+ |   | | | +-----------|---------------------------|-|-----------------------------|-----------------|-------------|-----|---|-|---+     | | | | | " + "\n" +
" | | | |   | | |     |   |     |   | |       |   |   | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | | " + "\n" +
" | | | |   | | |     |   |   +-----|-------------+   | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | | " + "\n" +
" | | | |   | | |     |   |   | |   | |       |       | |   | | |       |     | |       | |       |       | | |                           |       | |       |       |     |     | | | | | |     | | | | | " + "\n" +
" | | | +---|-+ +-----|---------|---+ |       |       | +-----|-|-------|-------|-----------------|---------------+                       |       | |       |       |     +-----|-|-+ | | | +-+ | | | | | " + "\n" +
" | | |     |         |   |   | |     |       |       |     | | |       |     | |       | |       |       | | |   |                       |       | |       |       |           | |   | | | | | | | | | | " + "\n" +
" | | | L---|---+     |   |   | |     |     +-----------------|---------------|---------|---------|-------|---|---|-----------------------|-------|---------|-------|---------------------|-+ | | | | | | " + "\n" +
" | | |     |   |     |   |   | |     |     | |       |     | | |       |     | |       | |       |       | | |   |                       |       | |       |       |           | |   | | |   | | | | | | " + "\n" +
" +-|---+   |   |     |   |   | |     |     | |       |     | | |       |     | |       +-|---------------|---|---|-----------------------|-------|-----------------------------------|-+ |   | | | | | | " + "\n" +
"   | | |   |   |     |   |   | |     |     | |       |     | | |       |     | |         |       |       | | |   |                       |       | |       |       |           | |   |   |   | | | | | | " + "\n" +
"   | | |   |   |     +---|-----|-----+     | |       |     | | |       |     | |         |       |       | | |   +-------------------------------|---------|-------|-----------+ +---------+ | | | | | | " + "\n" +
"   | | |   |   |         |   | |           | |       |     | | |       |     | |         |       |       | | |                           |       | |       |       |                 |   | | | | | | | | " + "\n" +
"   | | +---|-----------------|-|-----------|-|---+   |     | | |       +-----|-|-----------------|---------|-|---------------------------|---------|-------+       |                 |   | | | | | | | | " + "\n" +
"   | |     |   |         |   | |           | |   |   |     | | |             | |         |       |       | | |                           |       | |               |                 |   | | | | | | | | " + "\n" +
"   +-|---------+         |   | +-----------|-----+   |     | | |             | |         |       |       | | |                 +-----------------|-|---------------|-----------------+   +-+ +-|-|-+ | | " + "\n" +
"     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | | " + "\n" +
"     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | | " + "\n" +
"     |     |             |   |             | |       |     | | |             | |         |       |       | | |                 |         |       | |               |                           | |   | | " + "\n" +
"     |     |             |   |             | |       |     | | |             +-------------------|-------|Z--+                 |         |       | +---------------------------------------+   | |   | | " + "\n" +
"     |     |             |   |             | |       |     | | |               |         |       |       | |                   |         |       |                 |                       |   | |   | | " + "\n" +
"     |     |             |   |             | |       |     | +-----------------|---------|-------+       | |                   |         |       |                 +-------------------------+ | |   | | " + "\n" +
"     |     |             |   |             | |       |     |   |               |         |               | |                   |         |       |                                         | | | |   | | " + "\n" +
"     |     |             |   +-------------|---------|-----|---|---------------+ +---------------------------------------------|-----------------|-------------------------------------------|-|-|-----+ " + "\n" +
"     |     |             |                 | |       |     |   |                 |       |               | |                   |         |       |                                         | | | |   |   " + "\n" +
"     +-----|-------------|-----------------|-|-------+     |   |                 |       |               | |                   |         |       |                                         | | | |   |   " + "\n" +
"           |             |                 | |             |   |                 |       |               | |                   |         |       |                                         | | | |   |   " + "\n" +
"           |             +-----------------|---------------|---------------------+       |               | |                   |         |       |                                         | +---|-----+ " + "\n" +
"           |                               | |             |   |                         |               | |                   |         |       |                                         |   | |   | | " + "\n" +
"           |                   +---------------------------|---|-------------------------|-----------------|-------------------|---------+       |           +-----------------------------+   | |   | | " + "\n" +
"           |                   |           | |             |   |                         |               | |                   |                 |           |                                 | |   | | " + "\n" +
"           |                   |           | |             |   |                         |               | +-------+           |                 +-----------|-----------------------------------+   | | " + "\n" +
"           |                   |           | |             |   |                         |               |         |           |                             |                                 |     | | " + "\n" +
"           |                   |           | |             |   |                         |               +---------|-----------------------------------------|---------------------------------+   +-+ | " + "\n" +
"           |                   |           | |             |   |                         |                         |           |                             |                                     |   | " + "\n" +
"           |                   +-------------|-------------|---|---------------------------------------------------|-----------|-----------------------------|-----------------------------------------+ " + "\n" +
"           |                               | |             |   |                         |                         |           |                             |                                     |     " + "\n" +
"           |                               +-|-----------------+                         +-------------------------|-----------+                             +---------------+                 +---+     " + "\n" +
"           |                                 |             |                                                       |                                                         |                 |         " + "\n" +
"           +---------------------------------+             +-------------------------------------------------------+                                                         +-----------------+         ";

        private enum Direction
        {
            up,
            down,
            left,
            right
        }
        public static string SolveProblem1()
        {
            var lines = Utils.SplitToLines(Problem1Input).ToList();
            var width = lines[0].Length;
            var height = lines.Count;
            var grid = new char[width, height];

            for (int x=0; x<width; x++)
            {
                for (int y=0; y<height; y++)
                {
                    grid[x,y] = lines[y][x];
                }
            }

            var xPos = lines[0].IndexOf('|');
            var yPos = -1;
            var direction = Direction.up;
            var letters = new List<char>();

            while(true)
            {
                switch(direction)
                {
                    case Direction.up:
                        yPos++;
                        break;
                    case Direction.down:
                        yPos--;
                        break;
                    case Direction.left:
                        xPos--;
                        break;
                    case Direction.right:
                        xPos++;
                        break;
                }
                var newChar = grid[xPos,yPos];

                if (newChar == ' ')
                {
                    break;
                }
                else if (newChar != '-' && newChar != '|' && newChar != '+')
                {
                    letters.Add(newChar);
                }
                else if (newChar == '+')
                {
                    switch(direction)
                    {
                        case Direction.down:
                        case Direction.up:
                            if (xPos > 0 && grid[xPos-1, yPos] == '-')
                            {
                                direction = Direction.left;
                            }
                            else if (xPos < (width - 1) && grid[xPos+1, yPos] == '-')
                            {
                                direction = Direction.right;
                            }
                            break;
                        case Direction.left:
                        case Direction.right:
                            if (yPos > 0 && grid[xPos, yPos - 1] == '|')
                            {
                                direction = Direction.down;
                            }
                            else if (yPos < (height - 1) && grid[xPos, yPos+1] == '|')
                            {
                                direction = Direction.up;
                            }
                            break;
                    }
                }
            }

            return String.Join("", letters);
        }

        public static int SolveProblem2()
        {
            var lines = Utils.SplitToLines(Problem1Input).ToList();
            var width = lines[0].Length;
            var height = lines.Count;
            var grid = new char[width, height];

            for (int x=0; x<width; x++)
            {
                for (int y=0; y<height; y++)
                {
                    grid[x,y] = lines[y][x];
                }
            }

            var xPos = lines[0].IndexOf('|');
            var yPos = -1;
            var direction = Direction.up;
            var count = 0;

            while(true)
            {
                switch(direction)
                {
                    case Direction.up:
                        yPos++;
                        break;
                    case Direction.down:
                        yPos--;
                        break;
                    case Direction.left:
                        xPos--;
                        break;
                    case Direction.right:
                        xPos++;
                        break;
                }
                var newChar = grid[xPos,yPos];

                if (newChar == ' ')
                {
                    break;
                }
                else if (newChar == '+')
                {
                    switch(direction)
                    {
                        case Direction.down:
                        case Direction.up:
                            if (xPos > 0 && grid[xPos-1, yPos] == '-')
                            {
                                direction = Direction.left;
                            }
                            else if (xPos < (width - 1) && grid[xPos+1, yPos] == '-')
                            {
                                direction = Direction.right;
                            }
                            break;
                        case Direction.left:
                        case Direction.right:
                            if (yPos > 0 && grid[xPos, yPos - 1] == '|')
                            {
                                direction = Direction.down;
                            }
                            else if (yPos < (height - 1) && grid[xPos, yPos+1] == '|')
                            {
                                direction = Direction.up;
                            }
                            break;
                    }
                }

                count++;
            }

            return count;
        }
    }
}